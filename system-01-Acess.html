<!-- ▽ 기존 <script> 구간만 교체 ▽ -->
<script>
const PASS = "WATCHME";
let buf = "", ambienceStarted = false;   /* 불린 변수 이름 변경 */

let ctx;
const AC = () => ctx || (ctx = new (window.AudioContext || window.webkitAudioContext));

function tone(freq, type){
  const ac = AC(), osc = ac.createOscillator(), g = ac.createGain();
  osc.type = type; osc.frequency.value = freq; g.gain.value = .12;
  osc.connect(g).connect(ac.destination);
  osc.start();
  g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime + .35);
  osc.stop(ac.currentTime + .36);
}

/* 배경 Hum + 화이트노이즈 */
function startAmbience(){
  if (ambienceStarted) return;
  ambienceStarted = true;
  const ac = AC();

  // Hum
  const hum = ac.createOscillator(), hg = ac.createGain();
  hum.type = "sine"; hum.frequency.value = 50; hg.gain.value = .02;
  hum.connect(hg).connect(ac.destination); hum.start();

  // White noise
  const size = ac.sampleRate * 2,
        bufN = ac.createBuffer(1, size, ac.sampleRate),
        data = bufN.getChannelData(0);
  for (let i = 0; i < size; i++) data[i] = Math.random() * 2 - 1;
  const noise = ac.createBufferSource(), ng = ac.createGain();
  noise.buffer = bufN; noise.loop = true; ng.gain.value = .015;
  noise.connect(ng).connect(ac.destination); noise.start();
}

const typed = document.getElementById("typed"),
      msg   = document.getElementById("msg");

document.addEventListener("keydown", (e) => {
  startAmbience();
  const k = e.key;

  if (k === "Backspace") {
    e.preventDefault();
    buf = buf.slice(0, -1); typed.textContent = buf;
    return;
  }

  if (k === "Enter") {
    e.preventDefault();
    check();
    return;
  }

  if (k.length === 1 && buf.length < PASS.length) {
    buf += k.toUpperCase();
    typed.textContent = buf;
  }
});

function check(){
  if (buf === PASS){
    msg.style.color = "var(--green)";
    msg.textContent = "ACCESS GRANTED";
    tone(440, "triangle");
    setTimeout(()=>location.href="cctv.html", 1400);
  } else {
    msg.style.color = "#f44";
    msg.textContent = "ACCESS DENIED";
    tone(120, "sawtooth");
    document.getElementById("screen").style.animation = "glitch .35s 2";
    setTimeout(()=>document.getElementById("screen").style.animation = "none", 700);
    buf = ""; typed.textContent = "";
  }
}
</script>
